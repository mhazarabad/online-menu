{% extends 'menu/base.html' %}
{% load static %}
{% load menu_tags %}

{% block title %}{{ food.name }} - Online Menu{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'menu/css/food_detail.css' %}">
{% endblock %}

{% block content %}
<div class="detail-container">
    <a href="{% url 'menu_list' %}" class="back-link">‚Üê Back to Menu</a>
    
    <div class="food-detail-card">
        <div class="image-gallery">
            {% if food.has_header_image %}
            <img src="{{ food.header_image.url }}" alt="{{ food.name }}" class="main-image" id="mainImage" onclick="openModal(0)">
            {% else %}
            <div style="display: flex; align-items: center; justify-content: center; height: 100%; background: linear-gradient(135deg, #D4AF37 0%, #FF6B35 100%); color: white; font-size: 5rem; opacity: 0.5;">
                <span>üçΩÔ∏è</span>
            </div>
            {% endif %}
            
            {% if images %}
            <div class="image-thumbnails">
                {% if food.has_header_image %}
                <img src="{{ food.header_image.url }}" alt="{{ food.name }}" class="thumbnail active" onclick="changeMainImage('{{ food.header_image.url }}', 0)">
                {% endif %}
                {% for image in images %}
                <img src="{{ image.image.url }}" alt="{{ food.name }}" class="thumbnail" onclick="changeMainImage('{{ image.image.url }}', {{ forloop.counter }}{% if food.has_header_image %}{{ forloop.counter }}{% else %}{{ forloop.counter0 }}{% endif %})">
                {% endfor %}
            </div>
            {% endif %}
        </div>
        
        <div class="food-info">
            <div class="food-header">
                <h1 class="food-title">{{ food.name }}</h1>
                <div class="food-badges-detail">
                    {% if not is_available %}
                    <span class="badge badge-unavailable">Out of Order</span>
                    {% endif %}
                    {% if has_discount %}
                    <span class="badge badge-discount">{{ food.discount|format_discount }} OFF</span>
                    {% endif %}
                </div>
            </div>
            
            {% if food.description %}
            <div class="food-description-detail">
                {{ food.description }}
            </div>
            {% endif %}
            
            <div class="price-section">
                <div class="price price-large">
                    {% if has_discount %}
                    <span class="price-original">{{ food.price|format_price }}</span>
                    {% endif %}
                    <span class="price-final">{{ final_price|format_price }}</span>
                </div>
            </div>
            
            {% if available_toppings %}
            <div class="toppings-section">
                <h2 class="toppings-title">Available Toppings</h2>
                <div class="toppings-grid">
                    {% for topping_item in available_toppings %}
                    <div class="topping-card">
                        <div class="topping-name">{{ topping_item.topping.name }}</div>
                        {% if topping_item.topping.description %}
                        <p style="font-size: 0.95rem; color: var(--text-light); margin-bottom: 0.8rem; font-style: italic; line-height: 1.6;">{{ topping_item.topping.description }}</p>
                        {% endif %}
                        <div class="topping-price">
                            {% if topping_item.has_discount %}
                            <span style="text-decoration: line-through; color: #95a5a6; margin-right: 0.5rem;">{{ topping_item.topping.price|format_price }}</span>
                            {% endif %}
                            {{ topping_item.final_price|format_price }}
                            {% if topping_item.has_discount %}
                            <span class="badge badge-discount" style="margin-left: 0.5rem; font-size: 0.7rem;">{{ topping_item.topping.discount|format_discount }}</span>
                            {% endif %}
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<div id="imageModal" class="modal">
    <span class="close" onclick="closeModal()">&times;</span>
    <div class="modal-content">
        <span class="prev" onclick="changeSlide(-1)">&#10094;</span>
        <span class="next" onclick="changeSlide(1)">&#10095;</span>
        <img class="modal-image" id="modalImage" src="" alt="{{ food.name }}">
        <div class="image-info">
            <h3>{{ food.name }}</h3>
            <div class="image-info-price">
                {% if has_discount %}
                <span style="text-decoration: line-through; opacity: 0.7; margin-right: 0.5rem;">{{ food.price|format_price }}</span>
                {% endif %}
                {{ final_price|format_price }}
                {% if has_discount %}
                <span class="badge badge-discount" style="margin-left: 0.5rem;">{{ food.discount|format_discount }}</span>
                {% endif %}
            </div>
            {% if not is_available %}
            <span class="badge badge-unavailable" style="margin-top: 0.5rem; display: inline-block;">Out of Order</span>
            {% endif %}
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'menu/js/food_detail.js' %}"></script>
<script>
    const imageUrls = [
        {% if food.has_header_image %}'{{ food.header_image.url }}',{% endif %}
        {% for image in images %}'{{ image.image.url }}',{% endfor %}
    ];
    
    initializeImageGallery(imageUrls);
    
    document.getElementById('mainImage').addEventListener('click', function() {
        openModal(0);
    });
</script>
{% endblock %}

